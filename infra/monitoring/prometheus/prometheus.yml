global:
  scrape_interval: 15s
  evaluation_interval: 15s
  scrape_timeout: 10s

rule_files:
  - /etc/prometheus/rules/*.yml

alerting:
  alertmanagers:
    - static_configs:
        - targets:
            - alertmanager:9093

scrape_configs:
  # Prometheus self-monitoring
  - job_name: prometheus
    static_configs:
      - targets: ["localhost:9090"]

  # Backend (FastAPI) metrics
  - job_name: backend
    metrics_path: /metrics
    static_configs:
      - targets: ["backend:8000"]
    # Kubernetes SD (when running in K8s)
    # kubernetes_sd_configs:
    #   - role: pod
    # relabel_configs:
    #   - source_labels: [__meta_kubernetes_pod_label_app_kubernetes_io_name]
    #     action: keep
    #     regex: backend

  # Keycloak metrics
  - job_name: keycloak
    metrics_path: /metrics
    static_configs:
      - targets: ["keycloak:8080"]

  # Redis exporter (if deployed)
  - job_name: redis
    static_configs:
      - targets: ["redis-exporter:9121"]

  # MinIO metrics
  - job_name: minio
    metrics_path: /minio/v2/metrics/cluster
    static_configs:
      - targets: ["minio:9000"]

  # EDC connector metrics (when enabled)
  - job_name: edc-controlplane
    metrics_path: /api/check/health
    static_configs:
      - targets: ["edc-controlplane:19191"]

  - job_name: edc-dataplane
    metrics_path: /api/check/health
    static_configs:
      - targets: ["edc-dataplane:19192"]

  # Node exporter (if deployed)
  - job_name: node-exporter
    static_configs:
      - targets: ["node-exporter:9100"]

  # Kubernetes service discovery (uncomment in K8s)
  # - job_name: kubernetes-pods
  #   kubernetes_sd_configs:
  #     - role: pod
  #   relabel_configs:
  #     - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape]
  #       action: keep
  #       regex: true
  #     - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_path]
  #       action: replace
  #       target_label: __metrics_path__
  #       regex: (.+)
  #     - source_labels: [__address__, __meta_kubernetes_pod_annotation_prometheus_io_port]
  #       action: replace
  #       regex: ([^:]+)(?::\d+)?;(\d+)
  #       replacement: $1:$2
  #       target_label: __address__
  #     - action: labelmap
  #       regex: __meta_kubernetes_pod_label_(.+)
