# Secret template â€” populate via sealed-secrets, external-secrets, or Helm --set
# In production, use an external secrets operator rather than storing values in source control
apiVersion: v1
kind: Secret
metadata:
  name: {{ .Values.backend.secretRef }}
  namespace: {{ include "dpp-platform.namespace" . }}
  labels:
    {{- include "dpp-platform.labels" . | nindent 4 }}
type: Opaque
stringData:
  # PostgreSQL
  postgres-user: {{ required "postgresql credentials required" .Values.secrets.postgresUser | quote }}
  postgres-password: {{ required "postgresql credentials required" .Values.secrets.postgresPassword | quote }}
  database-url: "postgresql+asyncpg://{{ .Values.secrets.postgresUser }}:{{ .Values.secrets.postgresPassword }}@{{ include "dpp-platform.componentFullname" (dict "context" . "component" "postgresql") }}:{{ .Values.postgresql.port }}/dpp_platform"

  # Redis
  redis-password: {{ required "redis password required" .Values.secrets.redisPassword | quote }}
  redis-url: "redis://:{{ .Values.secrets.redisPassword }}@{{ include "dpp-platform.componentFullname" (dict "context" . "component" "redis") }}:{{ .Values.redis.port }}/0"

  # Keycloak
  keycloak-admin-user: {{ .Values.secrets.keycloakAdminUser | default "admin" | quote }}
  keycloak-admin-password: {{ required "keycloak admin password required" .Values.secrets.keycloakAdminPassword | quote }}
  keycloak-client-secret: {{ required "keycloak client secret required" .Values.secrets.keycloakClientSecret | quote }}
  keycloak-db-user: {{ .Values.secrets.keycloakDbUser | default "keycloak" | quote }}
  keycloak-db-password: {{ required "keycloak db password required" .Values.secrets.keycloakDbPassword | quote }}

  # MinIO
  minio-access-key: {{ required "minio access key required" .Values.secrets.minioAccessKey | quote }}
  minio-secret-key: {{ required "minio secret key required" .Values.secrets.minioSecretKey | quote }}

  # Application secrets
  encryption-master-key: {{ required "encryption master key required" .Values.secrets.encryptionMasterKey | quote }}
  dpp-signing-key: {{ required "DPP signing key required" .Values.secrets.dppSigningKey | quote }}

  {{- if .Values.edc.enabled }}
  # EDC
  edc-datasource-url: {{ .Values.secrets.edcDatasourceUrl | default "" | quote }}
  edc-datasource-user: {{ .Values.secrets.edcDatasourceUser | default "" | quote }}
  edc-datasource-password: {{ .Values.secrets.edcDatasourcePassword | default "" | quote }}
  edc-api-auth-key: {{ .Values.secrets.edcApiAuthKey | default "" | quote }}
  {{- end }}
