# Caddy reverse proxy configuration for production deployment.
# Automatically obtains and renews Let's Encrypt TLS certificates.

dpp-platform.dev {
	# Public API (unauthenticated) — allow caching
	handle /api/v1/public/* {
		header Cache-Control "public, max-age=300"
		reverse_proxy backend:8000
	}

	# API requests → FastAPI backend
	handle /api/* {
		reverse_proxy backend:8000
	}
	handle /health {
		reverse_proxy backend:8000
	}

	# Everything else → frontend (nginx serving the React SPA)
	handle {
		reverse_proxy frontend:8080
	}

	# NOTE: Caddy-level rate limiting for /api/v1/public/* requires
	# the caddy-ratelimit plugin. If available, add:
	#   rate_limit {remote.ip} 30r/m
	# inside the public API handle block.
	# Until then, backend Redis-based rate limiting handles throttling.
}

auth.dpp-platform.dev {
	reverse_proxy keycloak:8080
}
