{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://mini-dpp-platform.internal/schemas/inspection-findings.schema.json",
  "title": "Inspection Findings Register",
  "description": "Machine-mergeable findings register for DPP/AAS inspections.",
  "type": "object",
  "required": [
    "inspection_id",
    "generated_at",
    "baseline",
    "findings"
  ],
  "properties": {
    "inspection_id": {
      "type": "string",
      "pattern": "^CF-[0-9]{4}-[0-9]{2}-[0-9]{2}$"
    },
    "generated_at": {
      "type": "string",
      "format": "date-time"
    },
    "baseline": {
      "type": "object",
      "required": [
        "repo",
        "branch",
        "upstream_templates_ref",
        "carbon_footprint_version"
      ],
      "properties": {
        "repo": {
          "type": "string"
        },
        "branch": {
          "type": "string"
        },
        "upstream_templates_ref": {
          "type": "string"
        },
        "carbon_footprint_version": {
          "type": "string",
          "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$"
        }
      },
      "additionalProperties": false
    },
    "findings": {
      "type": "array",
      "items": {
        "type": "object",
        "required": [
          "id",
          "severity",
          "status",
          "owner_role",
          "title",
          "description",
          "repro_command",
          "acceptance_test",
          "target_sprint"
        ],
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^CF-[0-9]{3}$"
          },
          "severity": {
            "type": "string",
            "enum": [
              "P0",
              "P1",
              "P2",
              "P3"
            ]
          },
          "status": {
            "type": "string",
            "enum": [
              "Open",
              "In Progress",
              "Done",
              "Deferred"
            ]
          },
          "owner_role": {
            "type": "string"
          },
          "title": {
            "type": "string"
          },
          "description": {
            "type": "string"
          },
          "files": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "dependencies": {
            "type": "array",
            "items": {
              "type": "string",
              "pattern": "^CF-[0-9]{3}$"
            }
          },
          "repro_command": {
            "type": "string"
          },
          "acceptance_test": {
            "type": "string"
          },
          "target_sprint": {
            "type": "string"
          },
          "notes": {
            "type": "string"
          }
        },
        "additionalProperties": false
      }
    }
  },
  "additionalProperties": false
}
